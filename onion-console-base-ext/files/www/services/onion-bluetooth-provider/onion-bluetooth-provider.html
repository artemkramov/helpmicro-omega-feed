<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/promise-polyfill/promise-polyfill-lite.html">

<dom-module id="onion-bluetooth-provider">
	<script>
		'use strict';

		(function () {
			// var this = null;

			var created = function () {
				// this = this;
			};


			var ready = function () {
				// set default value for deviceRadio
				//this.deviceRadio = 'ra0';

				// set the deviceRadio based on the device type
				onionConsole.getService('onion-device-provider', function (err, deviceProvider) {
					console.log("DeviceProvider:",deviceProvider);
					console.log("err:",err);
					this.deviceProvider = deviceProvider;
				}.bind(this));
			};
			
			var getState = function (devId) {
				var promise = new Promise(function (resolve, reject) {
					this.deviceProvider.callService(devId, "onion-bt", 'state', {
						
					}, function (err, response) {
						if (response) {
							resolve( response );
						} else {
							reject(Error('Unable to read current bluetooth state.'));
						}
					}.bind(this));
				}.bind(this));

				return promise;
			}

			var setAdapterPower = function (devId, state) {
				var promise = new Promise(function (resolve, reject) {
					this.deviceProvider.callService(devId, "onion-bt", 'power', {
						"state": state
					}, function (err, response) {
						if (response && !response.err) {
							resolve(response);
						} else {
							reject('Unable to change bluetooth power.');
						}
					}.bind(this));
				}.bind(this));

				return promise;
			}

			

			Polymer({
				is: 'onion-bluetooth-provider',
				created: created,
				ready: ready,
				noop: function () {},

				//Get state
				getState: getState,
				setAdapterPower: setAdapterPower,

				properties: {
				}
			});
		})();
	</script>
</dom-module>
